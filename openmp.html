<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- CSS -->
<title>src/arraymancer/laser/openmp</title>
<link rel="stylesheet" type="text/css" href="nimdoc.out.css">

<script type="text/javascript" src="dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  toggleSwitch.addEventListener('change', switchTheme, false);


  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    document.documentElement.setAttribute('data-theme', "dark");
    toggleSwitch.checked = true;
  } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.documentElement.setAttribute('data-theme', "light");
    toggleSwitch.checked = false;
  } else {
    const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
    if (currentTheme) {
      document.documentElement.setAttribute('data-theme', currentTheme);

      if (currentTheme === 'dark') {
        toggleSwitch.checked = true;
      }
    }
  }
}
</script>

</head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Arraymancer - src/arraymancer/laser/openmp</title>

<link href="docutils.css" rel="stylesheet" type="text/css"/>
<link href="nav.css" rel="stylesheet" type="text/css"/>

<link href='http://fonts.googleapis.com/css?family=Raleway:400,600,900' rel='stylesheet' type='text/css'/>
<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<a href="https://github.com/mratsim/arraymancer"><img style="position: fixed; top: 0; right: 0; border: 0; z-index: 10;" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_gray_6d6d6d.png?resize=150%2C150" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"></a>

<body onload="main()">
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">src/arraymancer/laser/openmp</h1>
    <div class="row">
  <div class="three columns">
    <div class="theme-select-wrapper">
      <label for="theme-select">Theme:&nbsp;</label>
      <select id="theme-select" onchange="setTheme(this.value)">
        <option value="auto">ðŸŒ— Match OS</option>
        <option value="dark">ðŸŒ‘ Dark</option>
        <option value="light">ðŸŒ• Light</option>
      </select>
    </div>
    <div id="global-links">
      <ul class="simple">
        <li><a id="indexLink" href="theindex.html">Index</a></li>
      </ul>
    </div>
    <div id="searchInputDiv">
      Search: <input type="search" id="searchInput" onkeyup="search()"/>
    </div>
    <div>
      Group by:
      <select onchange="groupBy(this.value)">
        <option value="section">Section</option>
        <option value="type">Type</option>
      </select>
    </div>
    <ul class="simple simple-toc" id="toc-list">
  <li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#10" id="60">Consts</a></summary>
    <ul class="simple simple-toc-section">
      <li><a class="reference" href="#OMP_MEMORY_BOUND_GRAIN_SIZE" title="OMP_MEMORY_BOUND_GRAIN_SIZE {.intdefine.} = 1024">OMP_MEMORY_BOUND_GRAIN_SIZE</a></li>
<li><a class="reference" href="#OMP_NON_CONTIGUOUS_SCALE_FACTOR" title="OMP_NON_CONTIGUOUS_SCALE_FACTOR {.intdefine.} = 4">OMP_NON_CONTIGUOUS_SCALE_FACTOR</a></li>

    </ul>
  </details>
</li>
<li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#12" id="62">Procs</a></summary>
    <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">omp_suffix
  <li><a class="reference" href="#omp_suffix%2Cstaticbool" title="omp_suffix(genNew: static bool = false): string">omp_suffix(genNew: static bool = false): string</a></li>

</ul>

    </ul>
  </details>
</li>
<li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#17" id="67">Macros</a></summary>
    <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">omp_flush
  <li><a class="reference" href="#omp_flush.m%2Cvarargs%5Buntyped%5D" title="omp_flush(variables: varargs[untyped]): untyped">omp_flush(variables: varargs[untyped]): untyped</a></li>

</ul>

    </ul>
  </details>
</li>
<li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#18" id="68">Templates</a></summary>
    <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">attachGC
  <li><a class="reference" href="#attachGC.t" title="attachGC(): untyped">attachGC(): untyped</a></li>

</ul>
<ul class="simple nested-toc-section">detachGC
  <li><a class="reference" href="#detachGC.t" title="detachGC(): untyped">detachGC(): untyped</a></li>

</ul>
<ul class="simple nested-toc-section">omp_barrier
  <li><a class="reference" href="#omp_barrier.t" title="omp_barrier(): untyped">omp_barrier(): untyped</a></li>

</ul>
<ul class="simple nested-toc-section">omp_chunks
  <li><a class="reference" href="#omp_chunks.t%2CNatural%2Cuntyped%2Cuntyped%2Cuntyped" title="omp_chunks(omp_size: Natural; chunk_offset, chunk_size: untyped; body: untyped): untyped">omp_chunks(omp_size: Natural; chunk_offset, chunk_size: untyped; body: untyped): untyped</a></li>

</ul>
<ul class="simple nested-toc-section">omp_critical
  <li><a class="reference" href="#omp_critical.t%2Cuntyped" title="omp_critical(body: untyped): untyped">omp_critical(body: untyped): untyped</a></li>

</ul>
<ul class="simple nested-toc-section">omp_for
  <li><a class="reference" href="#omp_for.t%2Cuntyped%2CNatural%2Cstaticbool%2Cstaticbool%2Cuntyped" title="omp_for(index: untyped; length: Natural; use_simd, nowait: static bool;
        body: untyped)">omp_for(index: untyped; length: Natural; use_simd, nowait: static bool;
        body: untyped)</a></li>

</ul>
<ul class="simple nested-toc-section">omp_get_max_threads
  <li><a class="reference" href="#omp_get_max_threads.t" title="omp_get_max_threads(): cint">omp_get_max_threads(): cint</a></li>

</ul>
<ul class="simple nested-toc-section">omp_get_nested
  <li><a class="reference" href="#omp_get_nested.t" title="omp_get_nested(): cint">omp_get_nested(): cint</a></li>

</ul>
<ul class="simple nested-toc-section">omp_get_num_threads
  <li><a class="reference" href="#omp_get_num_threads.t" title="omp_get_num_threads(): cint">omp_get_num_threads(): cint</a></li>

</ul>
<ul class="simple nested-toc-section">omp_get_thread_num
  <li><a class="reference" href="#omp_get_thread_num.t" title="omp_get_thread_num(): cint">omp_get_thread_num(): cint</a></li>

</ul>
<ul class="simple nested-toc-section">omp_master
  <li><a class="reference" href="#omp_master.t%2Cuntyped" title="omp_master(body: untyped): untyped">omp_master(body: untyped): untyped</a></li>

</ul>
<ul class="simple nested-toc-section">omp_parallel
  <li><a class="reference" href="#omp_parallel.t%2Cuntyped" title="omp_parallel(body: untyped): untyped">omp_parallel(body: untyped): untyped</a></li>

</ul>
<ul class="simple nested-toc-section">omp_parallel_chunks
  <li><a class="reference" href="#omp_parallel_chunks.t%2CNatural%2Cuntyped%2Cuntyped%2CstaticNatural%2Cuntyped" title="omp_parallel_chunks(length: Natural; chunk_offset, chunk_size: untyped;
                    omp_grain_size: static Natural; body: untyped): untyped">omp_parallel_chunks(length: Natural; chunk_offset, chunk_size: untyped;
                    omp_grain_size: static Natural; body: untyped): untyped</a></li>

</ul>
<ul class="simple nested-toc-section">omp_parallel_chunks_default
  <li><a class="reference" href="#omp_parallel_chunks_default.t%2CNatural%2Cuntyped%2Cuntyped%2Cuntyped" title="omp_parallel_chunks_default(length: Natural; chunk_offset, chunk_size: untyped;
                            body: untyped): untyped">omp_parallel_chunks_default(length: Natural; chunk_offset, chunk_size: untyped;
                            body: untyped): untyped</a></li>

</ul>
<ul class="simple nested-toc-section">omp_parallel_for
  <li><a class="reference" href="#omp_parallel_for.t%2Cuntyped%2CNatural%2CstaticNatural%2Cstaticbool%2Cuntyped" title="omp_parallel_for(index: untyped; length: Natural;
                 omp_grain_size: static Natural; use_simd: static bool;
                 body: untyped)">omp_parallel_for(index: untyped; length: Natural;
                 omp_grain_size: static Natural; use_simd: static bool;
                 body: untyped)</a></li>

</ul>
<ul class="simple nested-toc-section">omp_parallel_for_default
  <li><a class="reference" href="#omp_parallel_for_default.t%2Cuntyped%2CNatural%2Cuntyped" title="omp_parallel_for_default(index: untyped; length: Natural; body: untyped)">omp_parallel_for_default(index: untyped; length: Natural; body: untyped)</a></li>

</ul>
<ul class="simple nested-toc-section">omp_parallel_if
  <li><a class="reference" href="#omp_parallel_if.t%2Cbool%2Cuntyped" title="omp_parallel_if(condition: bool; body: untyped)">omp_parallel_if(condition: bool; body: untyped)</a></li>

</ul>
<ul class="simple nested-toc-section">omp_set_nested
  <li><a class="reference" href="#omp_set_nested.t%2Ccint" title="omp_set_nested(x: cint)">omp_set_nested(x: cint)</a></li>

</ul>
<ul class="simple nested-toc-section">omp_set_num_threads
  <li><a class="reference" href="#omp_set_num_threads.t%2Ccint" title="omp_set_num_threads(x: cint)">omp_set_num_threads(x: cint)</a></li>

</ul>
<ul class="simple nested-toc-section">omp_single
  <li><a class="reference" href="#omp_single.t%2Cuntyped" title="omp_single(body: untyped): untyped">omp_single(body: untyped): untyped</a></li>

</ul>
<ul class="simple nested-toc-section">omp_single_nowait
  <li><a class="reference" href="#omp_single_nowait.t%2Cuntyped" title="omp_single_nowait(body: untyped): untyped">omp_single_nowait(body: untyped): untyped</a></li>

</ul>
<ul class="simple nested-toc-section">omp_task
  <li><a class="reference" href="#omp_task.t%2Cstaticstring%2Cuntyped" title="omp_task(annotation: static string; body: untyped): untyped">omp_task(annotation: static string; body: untyped): untyped</a></li>

</ul>
<ul class="simple nested-toc-section">omp_taskloop
  <li><a class="reference" href="#omp_taskloop.t%2Cuntyped%2CNatural%2Cstaticstring%2Cuntyped" title="omp_taskloop(index: untyped; length: Natural; annotation: static string;
             body: untyped)">omp_taskloop(index: untyped; length: Natural; annotation: static string;
             body: untyped)</a></li>

</ul>
<ul class="simple nested-toc-section">omp_taskwait
  <li><a class="reference" href="#omp_taskwait.t" title="omp_taskwait(): untyped">omp_taskwait(): untyped</a></li>

</ul>

    </ul>
  </details>
</li>

</ul>

  </div>
  <div class="nine columns" id="content">
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L1"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L1" class="link-seesrc" target="_blank" >Edit</a>

    <div id="tocRoot"></div>
    
    <p class="module-desc"></p>
    <div class="section" id="10">
  <h1><a class="toc-backref" href="#10">Consts</a></h1>
  <dl class="item">
    <div id="OMP_MEMORY_BOUND_GRAIN_SIZE">
  <dt><pre><a href="openmp.html#OMP_MEMORY_BOUND_GRAIN_SIZE"><span class="Identifier">OMP_MEMORY_BOUND_GRAIN_SIZE</span></a> {.<span class="Identifier">intdefine</span>.} <span class="Other">=</span> <span class="DecNumber">1024</span></pre></dt>
  <dd>
    
    This is the minimum amount of work per physical cores for memory-bound processing.<ul class="simple"><li>&quot;copy&quot; and &quot;addition&quot; are considered memory-bound</li>
<li>&quot;float division&quot; can be considered 2x~4x more complex and should be scaled down accordingly</li>
<li>&quot;exp&quot; and &quot;sin&quot; operations are compute-bound and there is a perf boost even when processing only 1000 items on 28 cores</li>
</ul>
<p>Launching 2 threads per core (HyperThreading) is probably desirable:</p>
<ul class="simple"><li><a class="reference external" href="https://medium.com/data-design/destroying-the-myth-of-number-of-threads-number-of-physical-cores-762ad3919880">https://medium.com/data-design/destroying-the-myth-of-number-of-threads-number-of-physical-cores-762ad3919880</a></li>
</ul>
<p>Raising the following parameters can have the following impact:</p>
<ul class="simple"><li>number of sockets: higher, more over memory fetch</li>
<li>number of memory channel: lower, less overhead per memory fetch</li>
<li>RAM speed: lower, less overhead per memory fetch</li>
<li>Private L2 cache: higher, feed more data per CPU</li>
<li>Hyperthreading and cache associativity</li>
<li>Cores, shared L3 cache: Memory contention</li>
</ul>
<p>Note that setting num_threads manually might impact performance negatively:</p>
<ul class="simple"><li><a class="reference external" href="http://studio.myrian.fr/openmp-et-num_threads/">http://studio.myrian.fr/openmp-et-num_threads/</a><blockquote class="markdown-quote"><p>2x2ms overhead when changing num_threads from 16-&gt;6-&gt;16</p></blockquote>
</li>
</ul>

    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L58"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L58" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>
<div id="OMP_NON_CONTIGUOUS_SCALE_FACTOR">
  <dt><pre><a href="openmp.html#OMP_NON_CONTIGUOUS_SCALE_FACTOR"><span class="Identifier">OMP_NON_CONTIGUOUS_SCALE_FACTOR</span></a> {.<span class="Identifier">intdefine</span>.} <span class="Other">=</span> <span class="DecNumber">4</span></pre></dt>
  <dd>
    
    Due to striding computation, we can use a lower grainsize for non-contiguous tensors
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L83"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L83" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

  </dl>
</div>
<div class="section" id="12">
  <h1><a class="toc-backref" href="#12">Procs</a></h1>
  <dl class="item">
    <div id="omp_suffix-procs-all">
  <div id="omp_suffix,staticbool">
  <dt><pre><span class="Keyword">proc</span> <a href="#omp_suffix%2Cstaticbool"><span class="Identifier">omp_suffix</span></a><span class="Other">(</span><span class="Identifier">genNew</span><span class="Other">:</span> <span class="Identifier">static</span> <span class="Identifier">bool</span> <span class="Other">=</span> <span class="Identifier">false</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">string</span> {.<span class="Identifier">compileTime</span>.}</pre></dt>
  <dd>
    
    genNew: if false, return the last suffix else return a fresh one
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L16"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L16" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>

  </dl>
</div>
<div class="section" id="17">
  <h1><a class="toc-backref" href="#17">Macros</a></h1>
  <dl class="item">
    <div id="omp_flush-macros-all">
  <div id="omp_flush.m,varargs[untyped]">
  <dt><pre><span class="Keyword">macro</span> <a href="#omp_flush.m%2Cvarargs%5Buntyped%5D"><span class="Identifier">omp_flush</span></a><span class="Other">(</span><span class="Identifier">variables</span><span class="Other">:</span> <span class="Identifier">varargs</span><span class="Other">[</span><span class="Identifier">untyped</span><span class="Other">]</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L400"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L400" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>

  </dl>
</div>
<div class="section" id="18">
  <h1><a class="toc-backref" href="#18">Templates</a></h1>
  <dl class="item">
    <div id="attachGC-templates-all">
  <div id="attachGC.t">
  <dt><pre><span class="Keyword">template</span> <a href="#attachGC.t"><span class="Identifier">attachGC</span></a><span class="Other">(</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    <p>If you are allocating reference types, sequences or strings in a parallel section, you need to attach and detach a GC for each thread. Those should be thread-local temporaries.</p>
<p>This attaches the GC.</p>
<p>Note: this creates too strange error messages when --threads is not on: <a class="reference external" href="https://github.com/nim-lang/Nim/issues/9489">https://github.com/nim-lang/Nim/issues/9489</a></p>

    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L89"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L89" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="detachGC-templates-all">
  <div id="detachGC.t">
  <dt><pre><span class="Keyword">template</span> <a href="#detachGC.t"><span class="Identifier">detachGC</span></a><span class="Other">(</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    <p>If you are allocating reference types, sequences or strings in a parallel section, you need to attach and detach a GC for each thread. Those should be thread-local temporaries.</p>
<p>This detaches the GC.</p>
<p>Note: this creates too strange error messages when --threads is not on: <a class="reference external" href="https://github.com/nim-lang/Nim/issues/9489">https://github.com/nim-lang/Nim/issues/9489</a></p>

    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L101"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L101" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_barrier-templates-all">
  <div id="omp_barrier.t">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_barrier.t"><span class="Identifier">omp_barrier</span></a><span class="Other">(</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L372"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L372" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_chunks-templates-all">
  <div id="omp_chunks.t,Natural,untyped,untyped,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_chunks.t%2CNatural%2Cuntyped%2Cuntyped%2Cuntyped"><span class="Identifier">omp_chunks</span></a><span class="Other">(</span><span class="Identifier">omp_size</span><span class="Other">:</span> <span class="Identifier">Natural</span><span class="Other">;</span> <span class="Identifier">chunk_offset</span><span class="Other">,</span> <span class="Identifier">chunk_size</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">;</span>
                    <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    Internal proc This is is the chunk part of omp_parallel_chunk omp_size should be a lvalue (assigned value) and not the result of a routine otherwise routine and its side-effect will be called multiple times
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L247"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L247" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_critical-templates-all">
  <div id="omp_critical.t,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_critical.t%2Cuntyped"><span class="Identifier">omp_critical</span></a><span class="Other">(</span><span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L348"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L348" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_for-templates-all">
  <div id="omp_for.t,untyped,Natural,staticbool,staticbool,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_for.t%2Cuntyped%2CNatural%2Cstaticbool%2Cstaticbool%2Cuntyped"><span class="Identifier">omp_for</span></a><span class="Other">(</span><span class="Identifier">index</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">;</span> <span class="Identifier">length</span><span class="Other">:</span> <span class="Identifier">Natural</span><span class="Other">;</span> <span class="Identifier">use_simd</span><span class="Other">,</span> <span class="Identifier">nowait</span><span class="Other">:</span> <span class="Identifier">static</span> <span class="Identifier">bool</span><span class="Other">;</span>
                 <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
  <dd>
    
    <p>OpenMP for loop (not parallel)</p>
<p>This must be used in an <tt class="docutils literal"><span class="pre"><span class="Identifier">omp_parallel</span></span></tt> block for parallelization.</p>
<p>Inputs:</p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">index</span></span></tt>, the iteration index, similar to for <tt class="docutils literal"><span class="pre"><span class="Identifier">index</span></span></tt> in 0 ..&lt; length: doSomething(<tt class="docutils literal"><span class="pre"><span class="Identifier">index</span></span></tt>)</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">length</span></span></tt>, the number of elements to iterate on</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">use_simd</span></span></tt>, instruct the compiler to unroll the loops for <tt class="docutils literal"><span class="pre"><span class="Identifier">simd</span></span></tt> use. For example, for float32: for i in 0..&lt;16: x<a class="reference internal" href="#i">i</a> += y<a class="reference internal" href="#i">i</a> will be unrolled to take 128, 256 or 512-bit to use SSE, AVX or AVX512. for 256-bit AVX: for i in countup(0, 2, 8): # Step 8 by 8 x<a class="reference internal" href="#i">i</a>   += y<a class="reference internal" href="#i">i</a> x<a class="reference internal" href="#i+1">i+1</a> += y<a class="reference internal" href="#i+1">i+1</a> x<a class="reference internal" href="#i+2">i+2</a> += y<a class="reference internal" href="#i+2">i+2</a> ...</li>
</ul>

    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L133"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L133" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_get_max_threads-templates-all">
  <div id="omp_get_max_threads.t">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_get_max_threads.t"><span class="Identifier">omp_get_max_threads</span></a><span class="Other">(</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">cint</span></pre></dt>
  <dd>
    
    
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L47"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L47" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_get_nested-templates-all">
  <div id="omp_get_nested.t">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_get_nested.t"><span class="Identifier">omp_get_nested</span></a><span class="Other">(</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">cint</span></pre></dt>
  <dd>
    
    
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L50"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L50" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_get_num_threads-templates-all">
  <div id="omp_get_num_threads.t">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_get_num_threads.t"><span class="Identifier">omp_get_num_threads</span></a><span class="Other">(</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">cint</span></pre></dt>
  <dd>
    
    
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L46"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L46" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_get_thread_num-templates-all">
  <div id="omp_get_thread_num.t">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_get_thread_num.t"><span class="Identifier">omp_get_thread_num</span></a><span class="Other">(</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">cint</span></pre></dt>
  <dd>
    
    
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L48"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L48" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_master-templates-all">
  <div id="omp_master.t,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_master.t%2Cuntyped"><span class="Identifier">omp_master</span></a><span class="Other">(</span><span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L354"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L354" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_parallel-templates-all">
  <div id="omp_parallel.t,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_parallel.t%2Cuntyped"><span class="Identifier">omp_parallel</span></a><span class="Other">(</span><span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    <p>Starts an openMP parallel section</p>
<p>Don't forget to use attachGC and detachGC if you are allocating sequences, strings, or reference types. Those should be thread-local temporaries.</p>

    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L113"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L113" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_parallel_chunks-templates-all">
  <div id="omp_parallel_chunks.t,Natural,untyped,untyped,staticNatural,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_parallel_chunks.t%2CNatural%2Cuntyped%2Cuntyped%2CstaticNatural%2Cuntyped"><span class="Identifier">omp_parallel_chunks</span></a><span class="Other">(</span><span class="Identifier">length</span><span class="Other">:</span> <span class="Identifier">Natural</span><span class="Other">;</span> <span class="Identifier">chunk_offset</span><span class="Other">,</span> <span class="Identifier">chunk_size</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">;</span>
                             <span class="Identifier">omp_grain_size</span><span class="Other">:</span> <span class="Identifier">static</span> <span class="Identifier">Natural</span><span class="Other">;</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    <p>Create a chunk for each thread. You can use: <tt class="docutils literal"><span class="pre"><span class="Keyword">for</span> <span class="Identifier">index</span> <span class="Keyword">in</span> <span class="Identifier">chunk_offset</span> <span class="Operator">..&lt;</span> <span class="Identifier">chunk_size</span><span class="Punctuation">:</span></span></tt> or <tt class="docutils literal"><span class="pre"><span class="Identifier">zeroMem</span><span class="Punctuation">(</span><span class="Identifier">foo</span><span class="Punctuation">[</span><span class="Identifier">chunk_offset</span><span class="Punctuation">]</span><span class="Operator">.</span><span class="Keyword">addr</span><span class="Punctuation">,</span> <span class="Identifier">chunk_size</span><span class="Punctuation">)</span></span></tt></p>
<p>Splits the input <tt class="docutils literal"><span class="pre"><span class="Identifier">length</span></span></tt> into chunks and do a parallel loop on each chunk. The number of chunks depends on the number of cores at runtime. <tt class="docutils literal"><span class="pre"><span class="Identifier">chunk_offset</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">chunk_size</span></span></tt> should be passed as undeclared identifiers. Within the template scope they will contain the start offset and the length of the current thread chunk. I.e. their value is thread-specific.</p>
<p>Use omp_get_thread_num() to get the current thread number</p>
<p>This is useful for non-contiguous processing as a replacement to omp_parallel_for or when operating on (contiguous) ranges for example for memset or memcpy.</p>
<p>Do not forget to use attachGC and detachGC if you are allocating sequences, strings, or reference types. Those should be thread-local temporaries.</p>

    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L293"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L293" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_parallel_chunks_default-templates-all">
  <div id="omp_parallel_chunks_default.t,Natural,untyped,untyped,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_parallel_chunks_default.t%2CNatural%2Cuntyped%2Cuntyped%2Cuntyped"><span class="Identifier">omp_parallel_chunks_default</span></a><span class="Other">(</span><span class="Identifier">length</span><span class="Other">:</span> <span class="Identifier">Natural</span><span class="Other">;</span>
                                     <span class="Identifier">chunk_offset</span><span class="Other">,</span> <span class="Identifier">chunk_size</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">;</span>
                                     <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    This will be renamed omp_parallel_chunks once <a class="reference external" href="https://github.com/nim-lang/Nim/issues/9414">https://github.com/nim-lang/Nim/issues/9414</a> is solved. Compared to omp_parallel_for the following are set by default<ul class="simple"><li>omp_grain_size: The default <tt class="docutils literal"><span class="pre"><span class="Identifier">OMP_MEMORY_BOUND_GRAIN_SIZE</span></span></tt> is suitable for contiguous copy or add operations. It's 1024 and can be changed by passing <tt class="docutils literal"><span class="pre"><span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">OMP_MEMORY_BOUND_GRAIN_SIZE</span><span class="Operator">=</span><span class="DecNumber">123456</span></span></tt> during compilation. A value of 1 will always parallelize the loop.</li>
</ul>

    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L327"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L327" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_parallel_for-templates-all">
  <div id="omp_parallel_for.t,untyped,Natural,staticNatural,staticbool,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_parallel_for.t%2Cuntyped%2CNatural%2CstaticNatural%2Cstaticbool%2Cuntyped"><span class="Identifier">omp_parallel_for</span></a><span class="Other">(</span><span class="Identifier">index</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">;</span> <span class="Identifier">length</span><span class="Other">:</span> <span class="Identifier">Natural</span><span class="Other">;</span>
                          <span class="Identifier">omp_grain_size</span><span class="Other">:</span> <span class="Identifier">static</span> <span class="Identifier">Natural</span><span class="Other">;</span> <span class="Identifier">use_simd</span><span class="Other">:</span> <span class="Identifier">static</span> <span class="Identifier">bool</span><span class="Other">;</span>
                          <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
  <dd>
    
    <p>Parallel for loop</p>
<p>Do not forget to use attachGC and detachGC if you are allocating sequences, strings, or reference types. Those should be thread-local temporaries.</p>
<p>Inputs:</p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">index</span></span></tt>, the iteration index, similar to for <tt class="docutils literal"><span class="pre"><span class="Identifier">index</span></span></tt> in 0 ..&lt; length: doSomething(<tt class="docutils literal"><span class="pre"><span class="Identifier">index</span></span></tt>)</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">length</span></span></tt>, the number of elements to iterate on</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">omp_grain_size</span></span></tt>, the minimal amount of work per thread. If below, we don't start threads. Note that we always start as much hardware threads as available as starting varying number of threads in the lifetime of the program will add oberhead.</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">use_simd</span></span></tt>, instruct the compiler to unroll the loops for <tt class="docutils literal"><span class="pre"><span class="Identifier">simd</span></span></tt> use. For example, for float32: for i in 0..&lt;16: x<a class="reference internal" href="#i">i</a> += y<a class="reference internal" href="#i">i</a> will be unrolled to take 128, 256 or 512-bit to use SSE, AVX or AVX512. for 256-bit AVX: for i in countup(0, 2, 8): # Step 8 by 8 x<a class="reference internal" href="#i">i</a>   += y<a class="reference internal" href="#i">i</a> x<a class="reference internal" href="#i+1">i+1</a> += y<a class="reference internal" href="#i+1">i+1</a> x<a class="reference internal" href="#i+2">i+2</a> += y<a class="reference internal" href="#i+2">i+2</a> ...</li>
</ul>

    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L167"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L167" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_parallel_for_default-templates-all">
  <div id="omp_parallel_for_default.t,untyped,Natural,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_parallel_for_default.t%2Cuntyped%2CNatural%2Cuntyped"><span class="Identifier">omp_parallel_for_default</span></a><span class="Other">(</span><span class="Identifier">index</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">;</span> <span class="Identifier">length</span><span class="Other">:</span> <span class="Identifier">Natural</span><span class="Other">;</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
  <dd>
    
    This will be renamed omp_parallel_for once <a class="reference external" href="https://github.com/nim-lang/Nim/issues/9414">https://github.com/nim-lang/Nim/issues/9414</a> is solved. Compared to omp_parallel_for the following are set by default<ul class="simple"><li>omp_grain_size: The default <tt class="docutils literal"><span class="pre"><span class="Identifier">OMP_MEMORY_BOUND_GRAIN_SIZE</span></span></tt> is suitable for contiguous copy or add operations. It's 1024 and can be changed by passing <tt class="docutils literal"><span class="pre"><span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">OMP_MEMORY_BOUND_GRAIN_SIZE</span><span class="Operator">=</span><span class="DecNumber">123456</span></span></tt> during compilation. A value of 1 will always parallelize the loop.</li>
<li>simd is used by default</li>
</ul>

    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L225"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L225" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_parallel_if-templates-all">
  <div id="omp_parallel_if.t,bool,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_parallel_if.t%2Cbool%2Cuntyped"><span class="Identifier">omp_parallel_if</span></a><span class="Other">(</span><span class="Identifier">condition</span><span class="Other">:</span> <span class="Identifier">bool</span><span class="Other">;</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
  <dd>
    
    
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L125"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L125" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_set_nested-templates-all">
  <div id="omp_set_nested.t,cint">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_set_nested.t%2Ccint"><span class="Identifier">omp_set_nested</span></a><span class="Other">(</span><span class="Identifier">x</span><span class="Other">:</span> <span class="Identifier">cint</span><span class="Other">)</span></pre></dt>
  <dd>
    
    
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L49"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L49" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_set_num_threads-templates-all">
  <div id="omp_set_num_threads.t,cint">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_set_num_threads.t%2Ccint"><span class="Identifier">omp_set_num_threads</span></a><span class="Other">(</span><span class="Identifier">x</span><span class="Other">:</span> <span class="Identifier">cint</span><span class="Other">)</span></pre></dt>
  <dd>
    
    
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L45"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L45" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_single-templates-all">
  <div id="omp_single.t,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_single.t%2Cuntyped"><span class="Identifier">omp_single</span></a><span class="Other">(</span><span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L360"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L360" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_single_nowait-templates-all">
  <div id="omp_single_nowait.t,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_single_nowait.t%2Cuntyped"><span class="Identifier">omp_single_nowait</span></a><span class="Other">(</span><span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L366"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L366" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_task-templates-all">
  <div id="omp_task.t,staticstring,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_task.t%2Cstaticstring%2Cuntyped"><span class="Identifier">omp_task</span></a><span class="Other">(</span><span class="Identifier">annotation</span><span class="Other">:</span> <span class="Identifier">static</span> <span class="Identifier">string</span><span class="Other">;</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L377"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L377" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_taskloop-templates-all">
  <div id="omp_taskloop.t,untyped,Natural,staticstring,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_taskloop.t%2Cuntyped%2CNatural%2Cstaticstring%2Cuntyped"><span class="Identifier">omp_taskloop</span></a><span class="Other">(</span><span class="Identifier">index</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">;</span> <span class="Identifier">length</span><span class="Other">:</span> <span class="Identifier">Natural</span><span class="Other">;</span>
                      <span class="Identifier">annotation</span><span class="Other">:</span> <span class="Identifier">static</span> <span class="Identifier">string</span><span class="Other">;</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
  <dd>
    
    OpenMP taskloop
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L388"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L388" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>
<div id="omp_taskwait-templates-all">
  <div id="omp_taskwait.t">
  <dt><pre><span class="Keyword">template</span> <a href="#omp_taskwait.t"><span class="Identifier">omp_taskwait</span></a><span class="Other">(</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    
    &nbsp;&nbsp;<a
href="https://github.com/mratsim/arraymancer/tree/master/src/arraymancer/laser/openmp.nim#L383"
class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/mratsim/arraymancer/edit/master/src/arraymancer/laser/openmp.nim#L383" class="link-seesrc" target="_blank" >Edit</a>

  </dd>
</div>

</div>

  </dl>
</div>

  </div>
</div>

    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br/>
        <small style="color: var(--hint);">Made with Nim. Generated: 2024-05-12 14:01:12 UTC</small>
      </div>
    </div>
  </div>
</div>

<header>
  <a class="pagetitle" href="index.html">Arraymancer</a>
  <span>
    <a href="#">Technical reference</a>
    <ul class="monospace" style="padding-bottom: 15px; padding-top: 10px;">
      <span>
      <li>
        <a href="#">Core tensor API</a>
        <ul class="monospace">
          <li><a href="accessors.html">accessors</a></li>
<li><a href="accessors_macros_read.html">accessors_macros_read</a></li>
<li><a href="accessors_macros_syntax.html">accessors_macros_syntax</a></li>
<li><a href="accessors_macros_write.html">accessors_macros_write</a></li>
<li><a href="aggregate.html">aggregate</a></li>
<li><a href="algorithms.html">algorithms</a></li>
<li><a href="blas_l3_gemm.html">blas_l3_gemm</a></li>
<li><a href="complex.html">complex</a></li>
<li><a href="cublas.html">cublas</a></li>
<li><a href="cuda.html">cuda</a></li>
<li><a href="cuda_global_state.html">cuda_global_state</a></li>
<li><a href="data_structure.html">data_structure</a></li>
<li><a href="display.html">display</a></li>
<li><a href="display_cuda.html">display_cuda</a></li>
<li><a href="einsum.html">einsum</a></li>
<li><a href="exporting.html">exporting</a></li>
<li><a href="filling_data.html">filling_data</a></li>
<li><a href="higher_order_applymap.html">higher_order_applymap</a></li>
<li><a href="higher_order_foldreduce.html">higher_order_foldreduce</a></li>
<li><a href="incl_accessors_cuda.html">incl_accessors_cuda</a></li>
<li><a href="incl_higher_order_cuda.html">incl_higher_order_cuda</a></li>
<li><a href="incl_kernels_cuda.html">incl_kernels_cuda</a></li>
<li><a href="init_copy_cpu.html">init_copy_cpu</a></li>
<li><a href="init_copy_cuda.html">init_copy_cuda</a></li>
<li><a href="init_cpu.html">init_cpu</a></li>
<li><a href="init_cuda.html">init_cuda</a></li>
<li><a href="init_opencl.html">init_opencl</a></li>
<li><a href="lapack.html">lapack</a></li>
<li><a href="math_functions.html">math_functions</a></li>
<li><a href="memory_optimization_hints.html">memory_optimization_hints</a></li>
<li><a href="naive_l2_gemv.html">naive_l2_gemv</a></li>
<li><a href="opencl_backend.html">opencl_backend</a></li>
<li><a href="opencl_global_state.html">opencl_global_state</a></li>
<li><a href="openmp.html">openmp</a></li>
<li><a href="operators_blas_l1.html">operators_blas_l1</a></li>
<li><a href="operators_blas_l1_cuda.html">operators_blas_l1_cuda</a></li>
<li><a href="operators_blas_l1_opencl.html">operators_blas_l1_opencl</a></li>
<li><a href="operators_blas_l2l3.html">operators_blas_l2l3</a></li>
<li><a href="operators_blas_l2l3_cuda.html">operators_blas_l2l3_cuda</a></li>
<li><a href="operators_blas_l2l3_opencl.html">operators_blas_l2l3_opencl</a></li>
<li><a href="operators_broadcasted.html">operators_broadcasted</a></li>
<li><a href="operators_broadcasted_cuda.html">operators_broadcasted_cuda</a></li>
<li><a href="operators_broadcasted_opencl.html">operators_broadcasted_opencl</a></li>
<li><a href="operators_comparison.html">operators_comparison</a></li>
<li><a href="operators_logical.html">operators_logical</a></li>
<li><a href="optim_ops_fusion.html">optim_ops_fusion</a></li>
<li><a href="p_accessors.html">p_accessors</a></li>
<li><a href="p_accessors_macros_desugar.html">p_accessors_macros_desugar</a></li>
<li><a href="p_accessors_macros_read.html">p_accessors_macros_read</a></li>
<li><a href="p_accessors_macros_write.html">p_accessors_macros_write</a></li>
<li><a href="p_checks.html">p_checks</a></li>
<li><a href="p_complex.html">p_complex</a></li>
<li><a href="p_display.html">p_display</a></li>
<li><a href="p_empty_tensors.html">p_empty_tensors</a></li>
<li><a href="p_init_cuda.html">p_init_cuda</a></li>
<li><a href="p_init_opencl.html">p_init_opencl</a></li>
<li><a href="p_kernels_interface_cuda.html">p_kernels_interface_cuda</a></li>
<li><a href="p_kernels_interface_opencl.html">p_kernels_interface_opencl</a></li>
<li><a href="p_operator_blas_l2l3.html">p_operator_blas_l2l3</a></li>
<li><a href="p_shapeshifting.html">p_shapeshifting</a></li>
<li><a href="selectors.html">selectors</a></li>
<li><a href="shapeshifting.html">shapeshifting</a></li>
<li><a href="shapeshifting_cuda.html">shapeshifting_cuda</a></li>
<li><a href="shapeshifting_opencl.html">shapeshifting_opencl</a></li>
<li><a href="syntactic_sugar.html">syntactic_sugar</a></li>
<li><a href="tensor_cuda.html">tensor_cuda</a></li>
<li><a href="tensor_opencl.html">tensor_opencl</a></li>
<li><a href="ufunc.html">ufunc</a></li>
        </ul>
      </li>
      </span>
      <span>
      <li>
        <a href="#">Neural network API</a>
        <ul class="monospace">
          <li><a href="conv2D.html">Layers: Convolution 2D</a></li>
<li><a href="cross_entropy_losses.html">Loss: Cross-Entropy losses</a></li>
<li><a href="embedding.html">Layers: Embedding</a></li>
<li><a href="flatten.html">flatten</a></li>
<li><a href="gcn.html">gcn</a></li>
<li><a href="gru.html">Layers: GRU (Gated Linear Unit)</a></li>
<li><a href="init.html">Layers: Initializations</a></li>
<li><a href="linear.html">Layers: Linear/Dense</a></li>
<li><a href="maxpool2D.html">Layers: Maxpool 2D</a></li>
<li><a href="mean_square_error_loss.html">Loss: Mean Square Error</a></li>
<li><a href="nn_dsl.html">Neural network: Declaration</a></li>
<li><a href="optimizers.html">Optimizers</a></li>
<li><a href="relu.html">Activation: Relu (Rectified linear Unit)</a></li>
<li><a href="sigmoid.html">Activation: Sigmoid</a></li>
<li><a href="softmax.html">Softmax</a></li>
<li><a href="tanh.html">Activation: Tanh</a></li>
        </ul>
      </li>
      </span>
      <span>
      <li>
        <a href="#">Linear algebra, stats, ML</a>
        <ul class="monospace">
          <li><a href="accuracy_score.html">Accuracy score</a></li>
<li><a href="algebra.html">algebra</a></li>
<li><a href="auxiliary_blas.html">auxiliary_blas</a></li>
<li><a href="auxiliary_lapack.html">auxiliary_lapack</a></li>
<li><a href="common_error_functions.html">Common errors, MAE and MSE (L1, L2 loss)</a></li>
<li><a href="dbscan.html">dbscan</a></li>
<li><a href="decomposition.html">Eigenvalue decomposition</a></li>
<li><a href="decomposition_lapack.html">decomposition_lapack</a></li>
<li><a href="decomposition_rand.html">Randomized Truncated SVD</a></li>
<li><a href="distributions.html">distributions</a></li>
<li><a href="init_colmajor.html">init_colmajor</a></li>
<li><a href="kde.html">kde</a></li>
<li><a href="kmeans.html">K-Means</a></li>
<li><a href="least_squares.html">Least squares solver</a></li>
<li><a href="least_squares_lapack.html">least_squares_lapack</a></li>
<li><a href="linear_systems.html">Linear systems solver</a></li>
<li><a href="overload.html">overload</a></li>
<li><a href="pca.html">Principal Component Analysis (PCA)</a></li>
<li><a href="solve_lapack.html">solve_lapack</a></li>
<li><a href="special_matrices.html">Special linear algebra matrices</a></li>
<li><a href="stats.html">Statistics</a></li>
<li><a href="triangular.html">triangular</a></li>
        </ul>
      </li>
      </span>
      <span>
      <li>
        <a href="#">IO & Datasets</a>
        <ul class="monospace">
          <li><a href="imdb.html">IMDB</a></li>
<li><a href="io_csv.html">CSV reading and writing</a></li>
<li><a href="io_hdf5.html">HDF5 files reading and writing</a></li>
<li><a href="io_image.html">Images reading and writing</a></li>
<li><a href="io_npy.html">Numpy files reading and writing</a></li>
<li><a href="io_stream_readers.html">io_stream_readers</a></li>
<li><a href="mnist.html">MNIST</a></li>
<li><a href="util.html">util</a></li>
        </ul>
      </li>
      </span>
      <span>
      <li>
        <a href="#">Autograd</a>
        <ul class="monospace">
          <li><a href="autograd_common.html">Data structure</a></li>
<li><a href="gates_basic.html">Basic operations</a></li>
<li><a href="gates_blas.html">Linear algebra operations</a></li>
<li><a href="gates_hadamard.html">Hadamard product (elementwise matrix multiply)</a></li>
<li><a href="gates_reduce.html">Reduction operations</a></li>
<li><a href="gates_shapeshifting_concat_split.html">Concatenation, stacking, splitting, chunking operations</a></li>
<li><a href="gates_shapeshifting_views.html">Linear algebra operations</a></li>
        </ul>
      </li>
      </span>
      <span>
      <li>
        <a href="#">Neuralnet primitives</a>
        <ul class="monospace">
          <li><a href="conv.html">conv</a></li>
<li><a href="cudnn.html">cudnn</a></li>
<li><a href="cudnn_conv_interface.html">cudnn_conv_interface</a></li>
<li><a href="nnp_activation.html">Activations</a></li>
<li><a href="nnp_conv2d_cudnn.html">Convolution 2D - CuDNN</a></li>
<li><a href="nnp_convolution.html">Convolution 2D</a></li>
<li><a href="nnp_embedding.html">Embeddings</a></li>
<li><a href="nnp_gru.html">Gated Recurrent Unit (GRU)</a></li>
<li><a href="nnp_linear.html">Linear / Dense layer</a></li>
<li><a href="nnp_maxpooling.html">Maxpooling</a></li>
<li><a href="nnp_numerical_gradient.html">Numerical gradient</a></li>
<li><a href="nnp_sigmoid_cross_entropy.html">Sigmoid Cross-Entropy loss</a></li>
<li><a href="nnp_softmax.html">Softmax</a></li>
<li><a href="nnp_softmax_cross_entropy.html">Softmax Cross-Entropy loss</a></li>
<li><a href="nnpack.html">nnpack</a></li>
<li><a href="nnpack_interface.html">nnpack_interface</a></li>
<li><a href="p_activation.html">p_activation</a></li>
<li><a href="p_logsumexp.html">p_logsumexp</a></li>
<li><a href="p_nnp_checks.html">p_nnp_checks</a></li>
<li><a href="p_nnp_types.html">p_nnp_types</a></li>
        </ul>
      </li>
      </span>
      <span>
      <li>
        <a href="#">Other docs</a>
        <ul class="monospace">
          <li><a href="align_unroller.html">align_unroller</a></li>
<li><a href="ast_utils.html">ast_utils</a></li>
<li><a href="compiler_optim_hints.html">compiler_optim_hints</a></li>
<li><a href="cpuinfo_x86.html">cpuinfo_x86</a></li>
<li><a href="datatypes.html">datatypes</a></li>
<li><a href="deprecate.html">deprecate</a></li>
<li><a href="dynamic_stack_arrays.html">dynamic_stack_arrays</a></li>
<li><a href="foreach.html">foreach</a></li>
<li><a href="foreach_common.html">foreach_common</a></li>
<li><a href="foreach_staged.html">foreach_staged</a></li>
<li><a href="functional.html">functional</a></li>
<li><a href="gemm.html">gemm</a></li>
<li><a href="gemm_packing.html">gemm_packing</a></li>
<li><a href="gemm_prepacked.html">gemm_prepacked</a></li>
<li><a href="gemm_tiling.html">gemm_tiling</a></li>
<li><a href="gemm_ukernel_avx.html">gemm_ukernel_avx</a></li>
<li><a href="gemm_ukernel_avx2.html">gemm_ukernel_avx2</a></li>
<li><a href="gemm_ukernel_avx512.html">gemm_ukernel_avx512</a></li>
<li><a href="gemm_ukernel_avx_fma.html">gemm_ukernel_avx_fma</a></li>
<li><a href="gemm_ukernel_dispatch.html">gemm_ukernel_dispatch</a></li>
<li><a href="gemm_ukernel_generator.html">gemm_ukernel_generator</a></li>
<li><a href="gemm_ukernel_generic.html">gemm_ukernel_generic</a></li>
<li><a href="gemm_ukernel_sse.html">gemm_ukernel_sse</a></li>
<li><a href="gemm_ukernel_sse2.html">gemm_ukernel_sse2</a></li>
<li><a href="gemm_ukernel_sse4_1.html">gemm_ukernel_sse4_1</a></li>
<li><a href="gemm_utils.html">gemm_utils</a></li>
<li><a href="global_config.html">global_config</a></li>
<li><a href="initialization.html">initialization</a></li>
<li><a href="math_ops_fusion.html">math_ops_fusion</a></li>
<li><a href="memory.html">memory</a></li>
<li><a href="nested_containers.html">nested_containers</a></li>
<li><a href="openmp.html">openmp</a></li>
<li><a href="sequninit.html">sequninit</a></li>
<li><a href="simd.html">simd</a></li>
<li><a href="tokenizers.html">tokenizers</a></li>
        </ul>
      </li>
      </span>
    </ul>
  </span>
  <span>
    <a href="#">Tutorial</a>
    <ul class="monospace">
      <li><a href="tuto.first_steps.html">First steps</a></li>
      <li><a href="tuto.slicing.html">Taking a slice of a tensor</a></li>
      <li><a href="tuto.linear_algebra.html">Matrix & vectors operations</a></li>
      <li><a href="tuto.broadcasting.html">Broadcasted operations</a></li>
      <li><a href="tuto.shapeshifting.html">Transposing, Reshaping, Permuting, Concatenating</a></li>
      <li><a href="tuto.map_reduce.html">Map & Reduce</a></li>
      <li><a href="tuto.iterators.html">Basic iterators</a></li>
    </ul>
  </span>
  <span>
    <a href="#">Spellbook (How-To&apos;s)</a>
    <ul class="monospace">
      <li><a href="howto.type_conversion.html">How to convert a Tensor type?</a></li>
      <li><a href="howto.ufunc.html">How to create a new universal function?</a></li>
      <li><a href="howto.perceptron.html">How to create a multilayer perceptron?</a></li>
    </ul>
  </span>
  <span>
    <a href="#">Under the hood</a>
    <ul class="monospace">
      <li><a href="uth.speed.html">How Arraymancer achieves its speed?</a></li>
      <li><a href="uth.copy_semantics.html">Why does `=` share data by default aka reference semantics?</a></li>
      <li><a href="uth.opencl_cuda_nim.html">Working with OpenCL and Cuda in Nim</a></li>
    </ul>
  </span>
</header>
</body>
</html>
